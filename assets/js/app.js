(function() { const root = document.documentElement; const savedTheme = localStorage.getItem('olp_theme'); const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; const theme = savedTheme || (prefersDark ? 'dark' : 'light'); root.setAttribute('data-theme', theme); const btn = document.getElementById('themeToggle'); if (btn) { btn.addEventListener('click', function() { const current = root.getAttribute('data-theme'); const next = current === 'dark' ? 'light' : 'dark'; root.setAttribute('data-theme', next); localStorage.setItem('olp_theme', next); btn.innerHTML = (next === 'dark' ? '☀️' : '🌙') + '<span></span>'; }); btn.innerHTML = (theme === 'dark' ? '☀️' : '🌙') + '<span></span>'; } window.OLP = { data: null, ready: null, getParam: function(name) { const params = new URLSearchParams(window.location.search); return params.get(name); }, findCourseById: function(id) { if (!this.data) return null; return this.data.courses.find(c => c.id === id || c.slug === id); }, loadData: function() { if (this.ready) return this.ready; this.ready = fetch('assets/data/courses.json', {cache: 'no-store'}) .then(r => r.json()) .then(json => { this.data = json; return json; }) .catch(err => { console.error('Failed to load courses.json', err); const el = document.getElementById('content'); if (el) el.innerHTML = '<div class="notice">Could not load data. If running locally, start a web server to avoid CORS issues (e.g., <code>python -m http.server</code>).</div>'; }); return this.ready; }, fmtPrice: function(p) { return p === 0 ? 'Free' : '$' + p.toFixed(2); }, star: function(r) { return '★'.repeat(Math.round(r)) + '☆'.repeat(5 - Math.round(r)); }, }; const path = location.pathname.split('/').pop(); document.querySelectorAll('.nav a').forEach(a => { if (a.getAttribute('href') === path) a.style.opacity = 1; }); })();