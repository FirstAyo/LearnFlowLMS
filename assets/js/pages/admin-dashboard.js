$(async function(){ if (localStorage.getItem('olp_admin_token') !== 'ok') { location.href = 'admin-login.html'; return; } await OLP.loadData(); let data = OLP.data || { categories: [], courses: [] }; function refresh(){ $('#stats').html(` <div class="card"> <div class="kicker">Dataset</div> <div><strong>${data.courses.length}</strong> courses across <strong>${data.categories.length}</strong> categories.</div> </div> `); const tbody = $('#coursesTable tbody'); tbody.empty(); data.courses.slice(0, 100).forEach(c => { tbody.append(`<tr> <td>${c.id}</td> <td>${c.title}</td> <td>${c.category}</td> <td>${c.level}</td> <td>${c.duration_hours}h</td> <td>${c.price===0?'Free':'$'+c.price.toFixed(2)}</td> </tr>`); }); $('#jsonArea').val(JSON.stringify(data, null, 2)); } refresh(); $('#fileInput').on('change', function(ev){ const file = ev.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function() { try { const parsed = JSON.parse(reader.result); if (!parsed.courses) throw new Error('Missing courses[]'); data = parsed; $('#msg').html('<div class="notice">Loaded dataset from file.</div>'); refresh(); } catch (e) { $('#msg').html('<div class="notice">Invalid JSON: '+ e.message +'</div>'); } }; reader.readAsText(file); }); $('#applyJson').on('click', function(){ try { const parsed = JSON.parse($('#jsonArea').val()); if (!parsed.courses) throw new Error('Missing courses[]'); data = parsed; $('#msg').html('<div class="notice">Applied edits.</div>'); refresh(); } catch (e) { $('#msg').html('<div class="notice">Invalid JSON: '+ e.message +'</div>'); } }); $('#downloadJson').on('click', function(){ const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'courses.json'; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0); }); $('#logout').on('click', function(){ localStorage.removeItem('olp_admin_token'); location.href = 'admin-login.html'; }); });